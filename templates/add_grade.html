{% extends "base.html" %}

{% block title %}Add Grade - EduFlow{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-8 mx-auto">
            <div class="card">
                <div class="card-header bg-warning text-dark">
                    <h4 class="mb-0">
                        <i class="fas fa-plus-circle"></i> Add New Grade
                    </h4>
                </div>
                <div class="card-body">
                    <form method="POST" class="needs-validation" novalidate>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="student_id" class="form-label">Student *</label>
                                <select class="form-select" id="student_id" name="student_id" required>
                                    <option value="">Select Student</option>
                                    {% for student in students %}
                                    <option value="{{ student.id }}">{{ student.name }} - {{ student.email }}</option>
                                    {% endfor %}
                                </select>
                                <div class="invalid-feedback">
                                    Please select a student.
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="course_id" class="form-label">Course *</label>
                                <select class="form-select" id="course_id" name="course_id" required>
                                    <option value="">Select Course</option>
                                    {% for course in courses %}
                                    <option value="{{ course.id }}">{{ course.code }} - {{ course.name }}</option>
                                    {% endfor %}
                                </select>
                                <div class="invalid-feedback">
                                    Please select a course.
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="grade" class="form-label">Grade *</label>
                                <select class="form-select" id="grade" name="grade" required>
                                    <option value="">Select Grade</option>
                                    <option value="A+">A+ (Excellent)</option>
                                    <option value="A">A (Outstanding)</option>
                                    <option value="A-">A- (Very Good)</option>
                                    <option value="B+">B+ (Good)</option>
                                    <option value="B">B (Above Average)</option>
                                    <option value="B-">B- (Average)</option>
                                    <option value="C+">C+ (Satisfactory)</option>
                                    <option value="C">C (Pass)</option>
                                    <option value="D">D (Conditional Pass)</option>
                                    <option value="F">F (Fail)</option>
                                </select>
                                <div class="invalid-feedback">
                                    Please select a grade.
                                </div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="semester" class="form-label">Semester *</label>
                                <select class="form-select" id="semester" name="semester" required>
                                    <option value="">Select Semester</option>
                                    <option value="1">Semester 1</option>
                                    <option value="2">Semester 2</option>
                                    <option value="3">Semester 3</option>
                                    <option value="4">Semester 4</option>
                                    <option value="5">Semester 5</option>
                                    <option value="6">Semester 6</option>
                                    <option value="7">Semester 7</option>
                                    <option value="8">Semester 8</option>
                                </select>
                                <div class="invalid-feedback">
                                    Please select a semester.
                                </div>
                            </div>
                        </div>
                        
                        <!-- Grade Information -->
                        <div class="row mb-3">
                            <div class="col-12">
                                <div class="alert alert-info">
                                    <h6><i class="fas fa-info-circle"></i> Grade Information</h6>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <strong>A+ to A-:</strong> Excellent to Very Good Performance<br>
                                            <strong>B+ to B-:</strong> Good to Average Performance
                                        </div>
                                        <div class="col-md-6">
                                            <strong>C+ to C:</strong> Satisfactory to Pass<br>
                                            <strong>D:</strong> Conditional Pass, <strong>F:</strong> Fail
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="d-flex justify-content-between">
                                    <a href="{{ url_for('grades') }}" class="btn btn-secondary">
                                        <i class="fas fa-arrow-left"></i> Back to Grades
                                    </a>
                                    <button type="submit" class="btn btn-warning">
                                        <i class="fas fa-save"></i> Add Grade
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Form validation
(function() {
    'use strict';
    const forms = document.querySelectorAll('.needs-validation');
    Array.prototype.slice.call(forms).forEach(function(form) {
        form.addEventListener('submit', function(event) {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }
            form.classList.add('was-validated');
        }, false);
    });
})();

// Dynamic grade color change
document.getElementById('grade').addEventListener('change', function() {
    const grade = this.value;
    const gradeColors = {
        'A+': 'success', 'A': 'success', 'A-': 'success',
        'B+': 'info', 'B': 'info', 'B-': 'info',
        'C+': 'warning', 'C': 'warning',
        'D': 'danger', 'F': 'danger'
    };
    
    // Remove existing color classes
    this.classList.remove('border-success', 'border-info', 'border-warning', 'border-danger');
    
    // Add new color class based on grade
    if (grade && gradeColors[grade]) {
        this.classList.add('border-' + gradeColors[grade]);
    }
});

// Student and course selection validation
document.getElementById('student_id').addEventListener('change', function() {
    const studentId = this.value;
    if (studentId) {
        // You could add AJAX call to fetch student details here
        console.log('Selected student ID:', studentId);
    }
});

document.getElementById('course_id').addEventListener('change', function() {
    const courseId = this.value;
    if (courseId) {
        // You could add AJAX call to fetch course details here
        console.log('Selected course ID:', courseId);
    }
});
</script>
{% endblock %}
